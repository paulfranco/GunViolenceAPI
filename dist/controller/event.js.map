{"version":3,"sources":["../../src/controller/event.js"],"names":["config","db","api","post","authenticate","req","res","newEvent","Event","date","body","save","err","send","json","get","find","events","findById","params","id","event","put","name","message","delete","remove","_id","newDetail","Detail","address","city","state","peopleKilled","peopleInjured","notes","source","imagePath","detail","details","push"],"mappings":"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","file":"event.js","sourcesContent":["import mongoose from 'mongoose';\nimport { Router } from 'express';\nimport Event from '../model/event';\nimport Detail from '../model/detail';\n\nimport { authenticate } from '../middleware/authMiddleware';\n\nexport default({ config, db }) => {\n    let api = Router();\n\n    // '/v1/event/add' - Create\n    api.post('/add', authenticate, (req, res) => {\n        let newEvent = new Event();\n        newEvent.date = req.body.date;\n\n        newEvent.save(err => {\n            if (err) {\n                res.send(err);\n            } else {\n                res.json({\n                    \"message\": \"Event saved Successfully\"\n                });\n            }\n        });\n    });\n\n    // '/v1/event' - Read All Events\n    api.get('/', (req, res) => {\n        Event.find({}, (err, events) => {\n            if (err) {\n                res.send(err);\n            } else {\n                res.json(events);\n            }\n        });\n    });\n\n    // '/v1/event/:id' - Read 1\n    api.get('/:id', (req, res) => {\n        Event.findById(req.params.id, (err, event) => {\n            if (err) {\n                res.send(err);\n            } else {\n                res.json(event);\n            }\n        });\n    });\n\n    // '/v1/event/:id' - Update\n    api.put('/:id', authenticate, (req, res) => {\n        Event.findById(req.params.id, (err, event) => {\n            if (err) {\n                res.send(err);\n            } else {\n                event.name = req.body.date;\n                event.save(err => {\n                    if (err) {\n                        res.send(err);\n                    } else {\n                        res.json({\n                            message: \"Event Information Updated\"\n                        });\n                    }\n                });\n            }\n        });\n    });\n\n    // '/v1/event/:id' - Delete\n    api.delete('/:id', authenticate, (req, res) => {\n        Event.remove({\n            _id: req.params.id\n        }, (err, event) => {\n            if (err) {\n                res.send(err);\n            } else {\n                res.json({\n                    message: \"Event Successfully Removed\"\n                });\n            }\n        });\n    });\n\n    // add details for a specific event id\n    // 'v1/event/details/add/:id\n    api.post('/details/add/:id', authenticate, (req, res) => {\n        Event.findById(req.params.id, (err, event) => {\n            if (err) {\n                res.send(err);\n            } else {\n                let newDetail = new Detail();\n\n                newDetail.address = req.body.address;\n                newDetail.city = req.body.city;\n                newDetail.state = req.body.state;\n                newDetail.peopleKilled = req.body.peopleKilled;\n                newDetail.peopleInjured = req.body.peopleInjured;\n                newDetail.notes = req.body.notes;\n                newDetail.source = req.body.source;\n                newDetail.imagePath = req.body.imagePath;\n                newDetail.event = event._id;\n\n                newDetail.save((err, detail) => {\n                    if (err) {\n                        res.send(err);\n                    } else {\n                        event.details.push(newDetail);\n                        event.save(err => {\n                            if (err) {\n                                res.send(err);\n                            } else {\n                                res.json({\n                                    message: \"Detail Successfully Saved\"\n                                });\n                            }\n                        });\n                    }\n                });\n            }\n        });\n    });\n\n    // Get detail for a specific event id\n    // '/v1/details/:id'\n    api.get('/details/:id', (req, res) => {\n        Detail.find({event: req.params.id}, (err, details) => {\n            if (err) {\n                res.send(err);\n            } else {\n                res.json(details);\n            }\n        });\n    });\n\n    return api;\n\n}"]}